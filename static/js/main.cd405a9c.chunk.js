(this["webpackJsonpreact-typescript-babylonjs"]=this["webpackJsonpreact-typescript-babylonjs"]||[]).push([[0],{16:function(e,t,n){e.exports={canvaContainer:"scene-1_canvaContainer__2Oiz4"}},17:function(e,t,n){e.exports={ui:"ui_ui__3YHo6"}},18:function(e,t,n){e.exports={score:"Score_score__2k693"}},27:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var s=n(2),i=n.n(s),a=n(15),o=n.n(a),r=(n(27),n(20)),c=n(16),h=n.n(c),u=n(3),l=n(6),d=n(0),m=n(8),p=n(11),v=n(1),f=["antialias","engineOptions","adaptToDeviceRatio","sceneOptions","onRender","onSceneReady"];var y=function(e){var t=Object(s.useRef)(null),n=e.antialias,i=e.engineOptions,a=e.adaptToDeviceRatio,o=e.sceneOptions,r=e.onRender,c=(e.onSceneReady,Object(p.a)(e,f));return Object(s.useEffect)((function(){if(t.current){var s=new d.Engine(t.current,n,i,a),c=new d.Scene(s,o);c.isReady()?e.onSceneReady(c):c.onReadyObservable.addOnce((function(t){return e.onSceneReady(t)})),s.runRenderLoop((function(){"function"===typeof r&&r(c),c.render()}));var h=function(){c.getEngine().resize()};return window&&window.addEventListener("resize",h),function(){c.getEngine().dispose(),window&&window.removeEventListener("resize",h)}}}),[a,n,i,r,e,t,o]),Object(v.jsx)("canvas",Object(m.a)(Object(m.a)({ref:t},c),{},{style:{width:"100%",height:"100%"}}))},w=n(4),b=n(5),g=n(10),O=n(22),x=n(21),M=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var s;return Object(w.a)(this,n),(s=t.call(this)).scene=e,s.states={died:!1},s.events={die:s.die.bind(Object(g.a)(s))},s.initSounds(),s}return Object(b.a)(n,[{key:"initSounds",value:function(){var e=new d.Sound("fall","assets/scene-1/songs/fall.mp3",this.scene,null,{volume:.5});this._sounds={fall:e}}},{key:"die",value:function(){var e,t;this.states.died=!0,this._sounds.fall.play(),null===(e=this.mesh)||void 0===e||null===(t=e.physicsImpostor)||void 0===t||t.dispose(),this.scene.beginDirectAnimation(this.mesh,function(){var e=.2,t=[],n=[],s=new d.Animation("ySlide","position.y",e,d.Animation.ANIMATIONTYPE_FLOAT,d.Animation.ANIMATIONLOOPMODE_CONSTANT),i=new d.Animation("Rotation","rotation.x",e,d.Animation.ANIMATIONTYPE_FLOAT,d.Animation.ANIMATIONLOOPMODE_CONSTANT);return t.push({frame:0,value:-.56}),t.push({frame:.8*e,value:1}),t.push({frame:2.3*e,value:-6}),s.setKeys(t),n.push({frame:0,value:-Math.PI/2}),n.push({frame:.8*e,value:Math.PI/2}),i.setKeys(n),[s,i]}(),0,5,!1)}},{key:"initMesh",value:function(){var e=Object(l.a)(Object(u.a)().mark((function e(){var t,n;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.SceneLoader.ImportMeshAsync("","assets/scene-1/meshes/cat/","cat.babylon",this.scene);case 2:t=e.sent,(n=t.meshes[0]).name="player",n.parent=null,n.position=new d.Vector3(-1.5,1,3.55),n.rotation.y+=-Math.PI/2,n.physicsImpostor=new d.PhysicsImpostor(n,d.PhysicsImpostor.BoxImpostor,{mass:.8,restitution:0}),n.rotationQuaternion=null,this._mesh=n;case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"mesh",get:function(){return this._mesh}}]),n}(Object(b.a)((function e(){Object(w.a)(this,e),this._mesh=void 0,this._parent=void 0,this._texture=void 0,this._sounds=void 0,this.events={},this.states={}}))),j=Object(b.a)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Object(w.a)(this,e),this.mesh=t,this.next=n,this.next=null})),I=function(){function e(){Object(w.a)(this,e),this._head=null,this._last=null,this._size=0}return Object(b.a)(e,[{key:"head",get:function(){return this._head}},{key:"last",get:function(){return this._last}},{key:"size",get:function(){return this._size}},{key:"removeFirstItem",value:function(){this._head&&(this._head=this._head.next,this._size--)}},{key:"addItem",value:function(e){this.head||(this._head=e),this.last&&(this.last.next=e),this._size++,this._last=e}},{key:"clear",value:function(){this._head=null}}]),e}(),k=["velocityX","velocityY","instancesQty"],P=function(){function e(t,n,s,i){var a=this,o=i.velocityX,r=void 0===o?0:o,c=i.velocityY,h=void 0===c?0:c,u=(i.instancesQty,Object(p.a)(i,k));Object(w.a)(this,e),this.name=void 0,this.container=void 0,this.parent=void 0,this.meshes=void 0,this.instances=void 0,this.instancesQty=0,this.parent=u.parent,this.container=new d.Mesh("".concat(t,"-infinity-container"),s),this.name=t,this.meshes=n,this.instances=new I,this.initializeMeshes(u.despawnPlace),this.fillSpawnSpace(u.spawnPlace,u.despawnPlace),s.onBeforeRenderObservable.add((function(){for(var e=s.getAnimationRatio(),t=a.instances.head;t;)t.mesh.position.x+=r*e,t.mesh.position.y+=h*e,t=t.next,a.instances.last.mesh.position.x<u.spawnPlace.x&&a.addInstance(),t&&t.mesh.position.x<u.despawnPlace.x&&a.removeInstance()}))}return Object(b.a)(e,[{key:"removeInstance",value:function(){this.instances.head.mesh.dispose(),this.instances.removeFirstItem()}},{key:"initializeMeshes",value:function(e){var t;null===(t=this.parent)||void 0===t||t.addChild(this.container),this.meshes.forEach((function(e){e.setEnabled(!1)}))}},{key:"positionLastMesh",value:function(e){var t=this.instances.last.mesh.getBoundingInfo().boundingBox.extendSizeWorld,n=this.instances.last.mesh.position,s=e.getBoundingInfo().boundingBox.extendSizeWorld,i=n.x+t.x+s.x,a=n.y,o=n.z;e.position=new d.Vector3(i,a,o)}},{key:"fillSpawnSpace",value:function(e,t){this.instances.addItem(new j(this.getMesh()));var n=!1;for(this.instances.last.mesh.position=new d.Vector3(t.x,t.y,t.z);!n;){var s=this.getMesh();this.positionLastMesh(s),this.instances.addItem(new j(s)),this.instances.last.mesh.position.x>e.x&&(n=!0)}}},{key:"addInstance",value:function(){var e=this.getMesh();this.positionLastMesh(e),this.instances.addItem(new j(e))}},{key:"getMesh",value:function(){var e,t=Math.floor(Math.random()*this.meshes.length),n=this.meshes[t].clone();return n.setEnabled(!0),null===(e=this.container)||void 0===e||e.addChild(n),n.name="".concat(this.instancesQty,"-").concat(this.name),this.instancesQty++,n}}]),e}();function T(e){var t=d.MeshBuilder.CreatePlane("sky",{width:10,height:20}),n=new d.StandardMaterial("skyMaterial",e),s=new d.Mesh("sky",e);return t.position.z=5,t.position.y=.3,n.diffuseColor=new d.Color3(95/255,165/255,245/255),n.specularColor=new d.Color3(0,0,0),t.material=n,new P("sky",[t],e,{velocityX:-.01,parent:s,spawnPlace:{z:20,x:26,y:0},despawnPlace:{z:20,x:-30,y:0}}),t}function S(e){var t=new d.Mesh("ground",e),n=function(e,t){var n=d.MeshBuilder.CreateBox("slider-ground",{width:10,height:1}),s=new d.StandardMaterial("groundMaterial",e);return s.diffuseTexture=new d.Texture("assets/scene-1/textures/ground.png",e),s.diffuseTexture.hasAlpha=!0,s.specularColor=new d.Color3(0,0,0),n.material=s,new P("slider-ground",[n],e,{velocityX:-.05,parent:t,spawnPlace:{x:8,z:3.55,y:-1.5},despawnPlace:{x:-8,z:3.55,y:-1.5}}),n}(e,t),s=function(e){var t=d.MeshBuilder.CreateBox("invisible-ground",{size:1}),n=new d.StandardMaterial("groundMaterial",e);return t.position=new d.Vector3(-1.5,-1.5,3.55),n.alpha=0,t.material=n,t.physicsImpostor=new d.PhysicsImpostor(t,d.PhysicsImpostor.BoxImpostor,{mass:0,restitution:0}),t}(e);return t.addChild(n),t.addChild(s),{sliderGround:n,invisibleGround:s}}function C(e){return A.apply(this,arguments)}function A(){return(A=Object(l.a)(Object(u.a)().mark((function e(t){var n,s;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.SceneLoader.ImportMeshAsync("","assets/scene-1/meshes/background/casas/","test.babylon",t);case 2:n=e.sent,s=new d.Mesh("background",t),n.meshes.forEach((function(e){s.addChild(e)})),new P("background",n.meshes,t,{velocityX:-.05,parent:s,spawnPlace:{z:13,x:26,y:-2},despawnPlace:{z:13,x:-15,y:-1.5}});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){var t=new d.ArcRotateCamera("camera",-Math.PI/2,Math.PI/2,0,new d.Vector3(0,0,0),e);return t.radius=0,t.attachControl(!0),t}function _(e,t,n){var s=new d.Sound("jump","assets/scene-1/songs/jump.mp3",t,null,{volume:.5}),i=new d.Vector3(0,1,0);s.play(),e&&e.mesh.physicsImpostor&&(n.jumping.isJumping=!0,n.jumping.canJump=!1,e.mesh.physicsImpostor.setLinearVelocity(new d.Vector3(0,0,0)),e.mesh.physicsImpostor.applyImpulse(i.scale(4.5),e.mesh.getAbsolutePosition()))}function E(e,t,n){var s=Object(m.a)({},n),i={},a=e;return a.actionManager=new d.ActionManager(e),a.actionManager.registerAction(new d.ExecuteCodeAction(d.ActionManager.OnKeyDownTrigger,(function(e){i[e.sourceEvent.key]="keydown"===e.sourceEvent.type}))),a.actionManager.registerAction(new d.ExecuteCodeAction(d.ActionManager.OnKeyUpTrigger,(function(e){i[e.sourceEvent.key]="keydown"===e.sourceEvent.type}))),a.onPointerObservable.add((function(n){s.jumping.canJump&&_(t,e,s)})),a.onBeforeRenderObservable.add((function(){i[" "]&&s.jumping.canJump&&_(t,e,s)})),s}var L=new function(){return this.score=0,this.onUpdateScore=new d.Observable,this},B=function(){function e(t,n){var s=this;Object(w.a)(this,e),this.scene=t,this.player=n,this.prevTime=(new Date).getTime(),this.currentTime=(new Date).getTime(),this.trySpawnTime=(new Date).getTime(),this.obstacleLimit=void 0,this.trySpawnTimeout=0,this.activeElement=[],this.obstacles=[],this.container=void 0,this.obstacleCounter=0,this.container=new d.Mesh("obstacles-container"),this.createObstaclesLimit(),this.scene.onBeforeRenderObservable.add((function(){for(var e=s.scene.getAnimationRatio(),t=s.activeElement.length-1;t>=0;t--)s.activeElement[t].position.x+=-.05*e,s.jumpedObstacle(s.activeElement[t])&&L.onUpdateScore.notifyObservers(++L.score),s.checkObstacleHit(s.activeElement[t]),s.checkObstacleHitsLimit(s.activeElement[t],t)}))}return Object(b.a)(e,[{key:"checkObstacleHit",value:function(e){var t;null!==(t=this.player.mesh)&&void 0!==t&&t.intersectsMesh(e)&&!this.player.states.died&&this.player.events.die()}},{key:"checkObstacleHitsLimit",value:function(e,t){var n;null!==(n=this.obstacleLimit)&&void 0!==n&&n.intersectsMesh(e)&&(this.activeElement[t].dispose(),this.activeElement.splice(t,1))}},{key:"jumpedObstacle",value:function(e){var t=e.getChildMeshes()[0],n=!!t&&t.intersectsMesh(this.player.mesh);return n&&t.dispose(),n}},{key:"canSpawn",value:function(e,t){var n=this.currentTime-this.prevTime>t,s=this.currentTime-this.prevTime>e,i=!1;return this.currentTime-this.trySpawnTime>this.trySpawnTimeout&&(this.trySpawnTime=this.currentTime,s&&(i=Math.random()>.5,n&&(i=!0))),i&&(this.prevTime=this.currentTime),i}},{key:"generateElement",value:function(){var e=this.obstacleCounter,t=this.obstacles,n=Math.floor(Math.random()*t.length);return this.obstacleCounter++,t[n].clone("obstacle-".concat(e))}},{key:"spawnObstacle",value:function(){var e=this.generateElement(),t=d.MeshBuilder.CreatePlane("pointPlane",{width:1,height:5},this.scene),n=new d.StandardMaterial("planeMateral",this.scene);e.position.z=3.55,e.position.y=-1,e.position.x=3,n.alpha=0,t.rotation.y=Math.PI/2,t.material=n,t.position=new d.Vector3(3,-1,3.55),e.addChild(t),this.container.addChild(e),this.activeElement.push(e)}},{key:"createObstacles",value:function(){var e=Object(l.a)(Object(u.a)().mark((function e(){var t,n,s,i;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.SceneLoader.ImportMeshAsync(null,"assets/scene-1/meshes/obstacles/trash/","trash.babylon",this.scene);case 2:return(t=e.sent).meshes[0].rotationQuaternion=null,t.meshes[0].rotation.y=Math.PI,t.meshes[0].rotation.x=-Math.PI/2,t.meshes[0].position.z=-100,t.meshes[0].name="trash",this.container.addChild(t.meshes[0]),e.next=11,d.SceneLoader.ImportMeshAsync(null,"assets/scene-1/meshes/obstacles/dog/","dog.babylon",this.scene);case 11:return(n=e.sent).meshes[0].scaling=new d.Vector3(.5,.5,.5),n.meshes[0].rotationQuaternion=null,n.meshes[0].rotation.y=Math.PI/2,n.meshes[0].position.z=-100,n.meshes[0].name="dog",this.container.addChild(n.meshes[0]),e.next=20,d.SceneLoader.ImportMeshAsync(null,"assets/scene-1/meshes/obstacles/cone/","cone.babylon",this.scene);case 20:return(s=e.sent).meshes[0].scaling=new d.Vector3(.5,.5,.5),s.meshes[0].rotationQuaternion=null,s.meshes[0].rotation.y=Math.PI/2,s.meshes[0].position.z=-100,s.meshes[0].name="cone",this.container.addChild(s.meshes[0]),e.next=29,d.SceneLoader.ImportMeshAsync(null,"assets/scene-1/meshes/obstacles/bucket/","bucket.babylon",this.scene);case 29:(i=e.sent).meshes[0].scaling=new d.Vector3(.005,.005,.005),i.meshes[0].rotationQuaternion=null,i.meshes[0].rotation.y=Math.PI/2,i.meshes[0].position.z=-100,i.meshes[0].name="bucket",this.container.addChild(i.meshes[0]),this.obstacles=[t.meshes[0],s.meshes[0],n.meshes[0],i.meshes[0]];case 37:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createObstaclesLimit",value:function(){this.obstacleLimit=d.MeshBuilder.CreatePlane("plane",{width:10,height:10},this.scene),this.obstacleLimit.position=new d.Vector3(-10,0,3.5),this.obstacleLimit.rotationQuaternion=null,this.obstacleLimit.rotation.y=-Math.PI/2}},{key:"init",value:function(){this.createObstacles()}},{key:"spawnWithDelay",value:function(e,t){this.currentTime=(new Date).getTime(),this.trySpawnTimeout=Math.floor(e/4),this.canSpawn(e,t)&&this.spawnObstacle()}}]),e}();function R(e){var t=d.MeshBuilder.CreatePlane("mountain",{width:20,height:4}),n=new d.StandardMaterial("mountainMaterial",e),s=new d.Mesh("mountain",e);return t.position.z=5,t.position.y=.3,n.diffuseTexture=new d.Texture("assets/scene-1/textures/mountains.png",e),n.diffuseTexture.hasAlpha=!0,n.specularColor=new d.Color3(0,0,0),t.material=n,new P("mountain",[t],e,{velocityX:-.01,parent:s,spawnPlace:{z:17,x:26,y:.1},despawnPlace:{z:17,x:-15,y:.1}}),t}function N(e){var t=d.MeshBuilder.CreatePlane("street",{width:10,height:10}),n=new d.StandardMaterial("streetMaterial",e),s=new d.Texture("assets/scene-1/textures/street.png",e),i=new d.Mesh("street",e);return s.wAng=-Math.PI/2,t.position.z=5,t.position.y=.3,t.rotation.x=Math.PI/2,n.diffuseTexture=s,n.diffuseTexture.hasAlpha=!0,n.specularColor=new d.Color3(0,0,0),t.material=n,new P("street",[t],e,{velocityX:-.05,parent:i,spawnPlace:{z:10.5,x:26,y:-1.4},despawnPlace:{z:10.5,x:-15,y:-1.4}}),t}function D(e){var t=d.MeshBuilder.CreatePlane("fence",{width:.2,height:1}),n=new d.StandardMaterial("fenceMaterial",e),s=new d.Texture("assets/scene-1/textures/fence.png",e),i=new d.Mesh("fence",e);return t.position.z=5,t.position.y=.3,n.diffuseTexture=s,n.diffuseTexture.hasAlpha=!0,n.specularColor=new d.Color3(0,0,0),t.material=n,new P("fence",[t],e,{velocityX:-.05,parent:i,spawnPlace:{z:14.7,x:26,y:-1},despawnPlace:{z:14.7,x:-15,y:-1}}),t}function V(e){return J.apply(this,arguments)}function J(){return(J=Object(l.a)(Object(u.a)().mark((function e(t){var n,s,i,a,o;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.getEngine(),t.enablePhysics(null,new d.AmmoJSPlugin(!1)),z(t),N(t),D(t),T(t),R(t),C(t),n=S(t),s=n.invisibleGround,n.sliderGround,i=new M(t),e.next=12,i.initMesh();case 12:return new d.HemisphericLight("light",new d.Vector3(0,0,0),t).intensity=2,a=new B(t,i),e.next=17,a.init();case 17:o={jumping:{canJump:!1,isJumping:!1,jumpStartTime:0}},new d.Sound("BgMusic","assets/scene-1/songs/bg-music.mp3",t,null,{loop:!0,autoplay:!0,volume:.2}),o=E(t,i,o),i.mesh.physicsImpostor.registerOnPhysicsCollide(s.physicsImpostor,(function(){o.jumping.canJump=!0,o.jumping.isJumping=!1})),t.onBeforeRenderObservable.add((function(){a.spawnWithDelay(1e3,2e3)}));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(){return Object(v.jsx)(y,{antialias:!0,id:"babylonscene",adaptToDeviceRatio:!0,onSceneReady:V})}var F=Object(s.memo)(Q),X=n(17),H=n.n(X),W=n(18),Y=n.n(W);function G(e){return Object(v.jsx)("span",{className:Y.a.score,children:e.score})}function K(e){return Object(v.jsx)("div",{className:H.a.ui,children:Object(v.jsx)(G,{score:e.score})})}var U=function(){var e=Object(s.useState)(0),t=Object(r.a)(e,2),n=t[0],i=t[1];return Object(s.useEffect)((function(){L.onUpdateScore.add((function(e){i(e)}))}),[]),Object(v.jsxs)("div",{className:h.a.canvaContainer,children:[Object(v.jsx)(F,{}),Object(v.jsx)(K,{score:n})]})},$=function(){return Object(v.jsx)(U,{})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,37)).then((function(t){var n=t.getCLS,s=t.getFID,i=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),s(e),i(e),a(e),o(e)}))};n(19)().then((function(){o.a.render(Object(v.jsx)(i.a.StrictMode,{children:Object(v.jsx)($,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),q()}))}},[[36,1,2]]]);
//# sourceMappingURL=main.cd405a9c.chunk.js.map